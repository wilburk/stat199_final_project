---
title: "PROJECT TITLE"
author: "NAME HERE"
date: "TODAY'S DATE"
output: github_document
---

### Load Packages & Data

```{r load-packages-data}
library(stringr)
library(tidyverse)
library(broom)

# run load-data.R first
food <- read_csv("data/food.csv")
food_attr <- read_csv("data/food-attributes.csv") 
food_hours <- read_csv("data/food-hours.csv")
```

```{r}
# food1 %>% 
#   filter(!is.na(attributes.NoiseLevel)) 
# 
# food1 %>%
#   filter(attributes.Alcohol != "full_bar") %>% 
#   select(attributes.Alcohol, categories)
# 
# food1 %>% 
#   count(attributes.RestaurantsPriceRange2)
```


### EDA -- Miles

```{r}
food_attr_temp <- food_attr %>% 
  select(-business_id)

food_attr_temp[is.na(food_attr_temp)] <- 0
food_attr_temp[food_attr_temp != 0] <- 1

# test <- food_attr_temp %>% 
#   summarise_all(funs(sum(. == "True"))) %>% 
#   gather(attribute, true, 1:ncol(.))
# 
# food_attr_temp %>% 
#   summarise_all(funs(sum(. == "False"))) %>% 
#   gather(attribute, false, 1:ncol(.)) %>% 
#   inner_join(test, by = "attribute") %>% 
#   mutate(total = false + true,
#          perc_true = round(true / (false + true),2)) %>% 
#   filter(total > 20, true > 0) %>% 
#   arrange(desc(total))

# numbers non null attribute values
food_attr_temp %>% 
  summarise_all(funs(sum(. == 1))) %>% 
  gather(attribute, total, 1:ncol(.)) %>% 
  arrange(desc(total))

# values for each attribute
food_attr %>% 
  select(-business_id) %>% 
  gather(attribute, vals, 1:ncol(.)) %>% 
  distinct() %>% 
  filter(!is.na(vals) & vals != TRUE & vals != FALSE)


```




```{r}




# ratings by alcohol & good for kids
food %>% 
  filter(!is.na(attributes.Alcohol), !is.na(attributes.GoodForKids)) %>% 
  group_by(attributes.GoodForKids, attributes.Alcohol) %>% 
  summarise(mean = mean(stars),
            n = n())

# get top # cities
food_small %>% 
  count(city) %>% 
  arrange(desc(n))

# filter for toronto, non null neighborhoods
toronto_neighborhood <- food_small %>% 
  filter(city == "Toronto", neighborhood != "")

# look at top neighborhoods
toronto_neighborhood %>%
  count(neighborhood) %>% 
  arrange(desc(n))

# aggregate postal codes (heirarchical structure so just took two few numbers)
toronto_neighborhood <- toronto_neighborhood %>%
  mutate(postal_code_short = substr(postal_code, 1 , 2))

# summary stats by neighborhood
toronto_neighborhood %>% 
  group_by(neighborhood) %>% 
  summarise(mean = mean(stars), n = n()) %>% 
  filter(n > 10) %>% 
  arrange(desc(mean))

# kmeans by attributes 7 through 10
kmns <- kmeans(toronto_neighborhood[7:10], 10)

# view kmeans results
head(augment(kmns, toronto_neighborhood))
tidy(kmns)

# view postal codes in space
ggplot(toronto_neighborhood, aes(x = latitude, y = longitude, color = postal_code_short)) +
  geom_point()
```
### kmeans

```{r}
# kmeans exploratory analysis
kmns <- data.frame(k=1:9) %>% 
  group_by(k) %>% 
  do(kmns=kmeans(toronto_neighborhood[7:8], .$k))

clusters <- kmns %>%
    group_by(k) %>%
    do(tidy(.$kmns[[1]]))

assignments <- kmns %>%
    group_by(k) %>%
    do(augment(.$kmns[[1]], toronto_neighborhood))

clusterings <- kmns %>%
    group_by(k) %>%
    do(glance(.$kmns[[1]]))

p1 <- ggplot(assignments, aes(latitude, longitude)) +
    geom_point(aes(color=.cluster)) +
    facet_wrap(~ k)

p1
```

### EDA -- Katie
```{r}
colSums(is.na(food_attr))
```


### EDA -- Ivy


