---
title: "Final Project"
author: "kimchi-stew"
date: "May 4th, 2018"
output: github_document
---

### Load Packages & Data

```{r load-packages-data}
library(stringr)
library(stringi)
library(tidyverse)
library(broom)
library(splitstackshape)
library(rpart)
library(rpart.plot)
library(RColorBrewer)
#library(sets)
library(rlist)
library(randomForest)
library(miscTools)
library(ggplot2)

set.seed(415)
# run load-data.R first
food <- read_csv("data/food.csv")
food_attr <- read_csv("data/food-attributes.csv") 
food_hours <- read_csv("data/food-hours.csv")

food_attr <- food_attr %>% 
  select(-starts_with("DietaryRestrictions"))

food_attr_col <- colnames(food_attr) %>% 
  as.data.frame() %>%
  mutate(cols = str_replace(., "-", "_")) %>% 
  select(-.) %>% 
  pull()

colnames(food_attr) <- food_attr_col

### NOTE ###
# See fifth code black starting at line 275 
# for the code to get significant columns

```

```{r initial_visualizations}

food_stars <- food %>%
  count(stars) %>% 
  arrange(desc(stars)) 
food_stars

ggplot(data = food_stars,aes(x = stars,y= n)) +
  geom_bar(stat = "identity",fill = "steelblue")+
  labs(title = "Count of of star ratings",y = "count")+
  geom_text(aes(label = n),position = "stack",vjust = 0) +
  scale_x_continuous(breaks = c(1,1.5,2,2.5,3,3.5,4,4.5,5))

food_states <- food %>%
  count(state) %>% 
  arrange(desc(n)) %>% 
  filter(n>100)

ggplot(food_states,aes(state,n)) +
  geom_col()+
  labs(title = "Number of restaurants in corresponding states")

food %>%
  summarise(mean = mean(stars),median = median(stars))


```

```{r map}

library(ggmap)
library(maps)
library(mapdata)

usa <- map_data("usa")
world_map <- map_data("world")
p <- ggplot() + coord_fixed() +
  xlab("") + ylab("")

#Add map to base plot
base_world_messy <- p + geom_polygon(data=world_map, aes(x=long, y=lat, group=group), 
                               colour="black", fill="black")
cleanup <- 
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
        panel.background = element_rect(fill = 'white', colour = 'white'), 
        axis.line = element_line(colour = "white"), legend.position="none",
        axis.ticks=element_blank(), axis.text.x=element_blank(),
        axis.text.y=element_blank())

base_world <- base_world_messy + cleanup

food <- food %>% 
  filter(longitude < 100 & longitude >-130) 
  #%>% 
  #filter(business_id != "vBxK_MAGuy8eWL_CCfUCUQ") %>% 
  #filter(latitude > -20 | latitude < -45)

map_data <- 
  base_world +
  geom_point(data=food, 
             aes(x=longitude, y=latitude), colour="red", 
             fill="Pink",pch=21, size=5, alpha=I(0.5))
map_data


```

```{r wrong_info_map}
food %>% 
  filter(longitude > 100)

food %>% 
  filter(longitude < -130)

food %>% 
  filter(latitude < 28 & latitude > 0)

food %>% 
  filter(latitude < -20 & latitude > -45)
```


```{r recode_variables, message=FALSE}

food_attr_temp <- food_attr %>% 
  select(-business_id) %>% 
  mutate(BusinessParking =  BusinessParking.garage	  == TRUE	|	 	
                            BusinessParking.street    == TRUE |				
                            BusinessParking.validated	== TRUE	|	 
                            BusinessParking.lot       == TRUE |	
                            BusinessParking.valet     == TRUE,
         Music =  Music.dj                == TRUE |				
                  Music.background_music	== TRUE |			
                  Music.no_music		      == TRUE |		
                  Music.karaoke	          == TRUE |			
                  Music.live              == TRUE | 
                  Music.video             == TRUE |			
                  Music.jukebox	          == TRUE ,	
         Ambience = Ambience.romantic	== TRUE |			
                    Ambience.intimate	== TRUE |			
                    Ambience.classy		== TRUE |		
                    Ambience.hipster	== TRUE |			
                    Ambience.divey		== TRUE |		
                    Ambience.touristy	== TRUE |			
                    Ambience.trendy		== TRUE |		
                    Ambience.upscale  == TRUE |
                    Ambience.casual		== TRUE,	
         BestNights = BestNights.monday	  	== TRUE |	
                      BestNights.tuesday		== TRUE |			
                      BestNights.friday			== TRUE |		
                      BestNights.wednesday	== TRUE |				
                      BestNights.thursday		== TRUE |			
                      BestNights.sunday			== TRUE |		
                      BestNights.saturday		== TRUE,	
         GoodForMeal =  GoodForMeal.dessert   == TRUE |		
                        GoodForMeal.latenight	== TRUE |
                        GoodForMeal.lunch		  == TRUE |			
                        GoodForMeal.dinner		== TRUE |			
                        GoodForMeal.breakfast	== TRUE |		
                        GoodForMeal.brunch		== TRUE)	

food_attr_temp[is.na(food_attr_temp)] <- 0
food_attr_temp[food_attr_temp != 0] <- 1


food_attr_temp %>% 
  summarise_all(funs(sum(. == 1))) %>% 
  gather(attribute, total, 1:ncol(.)) %>% 
  arrange(desc(total)) %>% 
  filter(!str_detect(attribute, "\\."))


# numbers non null attribute values
food_attr_counts <- food_attr_temp %>% 
  summarise_all(funs(sum(. == 1))) %>% 
  gather(attribute, total, 1:ncol(.)) %>% 
  arrange(desc(total))
  #filter(!str_detect(attribute, "\\."))
 
level_props <- data.frame(attribute = colnames(food_attr)) %>% 
  filter(str_detect(attribute, "\\.")) %>% 
  inner_join(food_attr_counts, by = "attribute") %>% 
  mutate(attribute_parent = str_remove(attribute, "\\..+"),
         attribute = str_remove(attribute, ".+\\.")) %>%
  rename(subtotal = total) %>% 
  inner_join(food_attr_counts, by = c("attribute_parent" = "attribute")) %>% 
  mutate(prop = subtotal / total) %>% 
  mutate(subtotal = case_when(attribute == "hipster" ~ as.double(858),
                              attribute != "hipster" ~ as.double(subtotal))) %>% 
  arrange(attribute_parent, desc(prop)) 

level_props[4,2] <- 858
level_props[4,5] <- 0.03737
level_props

data.frame(attribute = colnames(food_attr)) %>% 
  filter(str_detect(attribute, "\\.")) %>% 
  inner_join(food_attr_counts, by = "attribute") %>% 
  mutate(attribute_parent = str_remove(attribute, "\\..+")) %>%
  rename(subtotal = total) %>% 
  inner_join(food_attr_counts, by = c("attribute_parent" = "attribute")) %>% 
  mutate(prop = subtotal / total) %>% 
  arrange(attribute_parent, desc(prop)) %>% 
  group_by(attribute_parent) %>% 
  summarise(undisjoint_factor = sum(subtotal) / median(total))

```


```{r count_columns_to_find_variables_for_analysis}
convert_dot <- function(col_name) {
  col_name_short <- str_remove(col_name, ".+\\.")
  index <- grep(col_name, colnames(food_attr))
  col <- food_attr[index]
  col[col == TRUE] <- paste0(col_name_short, ",")
  col[col == FALSE] <- "."
  return(col)
}

lst <- food_attr %>% 
  select(contains(".")) %>% 
  colnames() 

food_attr_convert <- map(lst, convert_dot) %>% 
  as.data.frame()


food_attr_convert <- food_attr_convert %>% 
  mutate(aggBusinessParking =  paste0(BusinessParking.garage,	 	
                                      BusinessParking.street,			
                                      BusinessParking.validated,	 
                                      BusinessParking.lot,
                                      BusinessParking.valet, sep=""),
         aggMusic = paste0(Music.dj,				
                           Music.background_music,		
                           Music.no_music,
                           Music.karaoke	,
                           Music.live,
                           Music.video,			
                           Music.jukebox, sep=""),
         aggAmbience = paste0(Ambience.romantic,
                              Ambience.intimate,		
                              Ambience.classy	,	
                              Ambience.hipster,		
                              Ambience.divey	,	
                              Ambience.touristy,		
                              Ambience.trendy	,	
                              Ambience.upscale,
                              Ambience.casual, sep=""),
         aggBestNights = paste0(BestNights.monday	 ,	
                                BestNights.tuesday		,	
                                BestNights.friday			,
                                BestNights.wednesday	,		
                                BestNights.thursday		,	
                                BestNights.sunday			,
                                BestNights.saturday, sep=""),
         aggGoodForMeal = paste0(GoodForMeal.dessert,		
                                 GoodForMeal.latenight,
                                 GoodForMeal.lunch		  ,	
                                 GoodForMeal.dinner		,	
                                 GoodForMeal.breakfast	,
                                 GoodForMeal.brunch, sep="")) %>% 
  select(-contains(".")) %>% 
  mutate_all(funs(str_replace_all(.,",+", ","))) %>% 
  mutate_all(funs(str_replace_all(., "[NA]+", "NA"))) %>% 
  mutate_all(funs(str_remove_all(., "\\.NA|NA\\."))) %>% 
  mutate_all(funs(str_replace_all(., "^\\.+$", "None"))) %>% 
  mutate_all(funs(str_remove_all(., "\\.+"))) %>% 
  mutate_all(funs(str_remove(.,"^,"))) %>% 
  mutate_all(funs(str_remove(.,",$")))


food_attr_convert[food_attr_convert == "NA"] <- NA

### PROBLEM: too many collisions between variables - need to reduce to one value; don't want to eliminate too much information
### SOLUTION1: choose in order of frequency, low to high
### IMPLEMENTATION: iterate through, call function: if (numberofcommas + 1) > 1: split into vector, for each element in vector
### PROBLEM: if all slightly equal numbers but still collisions, some vals might not get seen

pick_index_min <- function(freq_vect) {
  return(grep(min(freq_vect), freq_vect))
}

pick_index_max <- function(freq_vect) {
  return(grep(max(freq_vect), freq_vect))
}

pick_index_prob <- function(freq_vect) {
  ord_vect <- sort(freq_vect)
  total <- reduce(freq_vect, sum)
  ord_vect_prob <- sapply(ord_vect, function(x) x/total)
  rev_vect_prob <- sort(ord_vect_prob, decreasing = TRUE)
  for (i in 2:length(rev_vect_prob)){
    rev_vect_prob[[i]] <- rev_vect_prob[[i]] + rev_vect_prob[[i-1]]
  }
  rand <- runif(1)
  ind <- which(sapply(rev_vect_prob, function (x) x > rand))[[1]]
  return(grep(ord_vect[[ind]],freq_vect))
}

level_props

my_reduce <- function(col) {

  for (i in 1:length(col)) {
    val_list <- col[[i]]
    if (is.na(val_list) | val_list == "None" | !str_detect(val_list, ",")) {
      col[[i]] <- val_list
    } else {
      vals <- unlist(str_split(val_list, ","))
      freq_vect <- c()
      for (val in vals) {
        freq <- level_props %>%
          filter(attribute == val) %>%
          select(subtotal) %>%
          pull()
        freq_vect <- c(freq_vect, freq)
      }
      index <- pick_index_min(freq_vect)
      col[[i]] <- vals[index]
    }
  }
  return(col)
}

food_attr_reduce <- food_attr_convert %>% 
  mutate_all(funs(my_reduce))

```



```{r aggregate_categorical_variables}
food_attr_mod_2 <- food_attr %>% 
  as.data.frame() %>% 
  select(-business_id) %>% 
  mutate(aggBusinessParking =  BusinessParking.garage	  == TRUE	|	 	
                            BusinessParking.street    == TRUE |				
                            BusinessParking.validated	== TRUE	|	 
                            BusinessParking.lot       == TRUE |	
                            BusinessParking.valet     == TRUE,
         aggMusic =  Music.dj                == TRUE |				
                  Music.background_music	== TRUE |			
                  Music.no_music		      == TRUE |		
                  Music.karaoke	          == TRUE |			
                  Music.live              == TRUE | 
                  Music.video             == TRUE |			
                  Music.jukebox	          == TRUE ,	
         aggAmbience = Ambience.romantic	== TRUE |			
                    Ambience.intimate	== TRUE |			
                    Ambience.classy		== TRUE |		
                    Ambience.hipster	== TRUE |			
                    Ambience.divey		== TRUE |		
                    Ambience.touristy	== TRUE |			
                    Ambience.trendy		== TRUE |		
                    Ambience.upscale  == TRUE |
                    Ambience.casual		== TRUE,	
         aggBestNights = BestNights.monday	  	== TRUE |	
                      BestNights.tuesday		== TRUE |			
                      BestNights.friday			== TRUE |		
                      BestNights.wednesday	== TRUE |				
                      BestNights.thursday		== TRUE |			
                      BestNights.sunday			== TRUE |		
                      BestNights.saturday		== TRUE,	
         aggGoodForMeal =  GoodForMeal.dessert   == TRUE |		
                        GoodForMeal.latenight	== TRUE |
                        GoodForMeal.lunch		  == TRUE |			
                        GoodForMeal.dinner		== TRUE |			
                        GoodForMeal.breakfast	== TRUE |		
                        GoodForMeal.brunch		== TRUE)	%>% 
  select(-starts_with("Ambience"),-starts_with("GoodForMeal"),-starts_with("Music"),-starts_with("BusinessParking"), -starts_with("BestNights"),-ByAppointmentOnly, -CoatCheck, -RestaurantsCounterService, -Corkage, -ByAppointmentOnly, -AgesAllowed, -BusinessAcceptsBitcoin, -BYOB, -Open24Hours)




food_attr_mod_2 <- food_attr %>% 
  cbind(food_attr_reduce) %>% 
  select(business_id, BusinessAcceptsCreditCards,RestaurantsPriceRange2,GoodForKids,BikeParking,Alcohol,HasTV,NoiseLevel,RestaurantsAttire,RestaurantsGoodForGroups,Caters,WiFi,RestaurantsReservations,RestaurantsTakeOut, aggBusinessParking, aggAmbience, aggGoodForMeal) %>% 
  drop_na()

```

```{r}
food_tall <- food %>% 
  cSplit("categories", direction = "tall", sep = ",") 

(category_counts <- food_tall %>% 
  count(categories) %>% 
  arrange(desc(n)))

category_list <- food_tall %>% 
  count(categories) %>% 
  arrange(desc(n)) %>%
  head(30) %>% 
 # summarise(n = sum(n))
  filter(categories != "event planning & services", categories != "shopping") %>% 
  pull(categories)

food_tall_reduce <- food_tall %>% 
  filter(categories %in% category_list)


```

```{r random_forest}
my_reduce_2 <- function(col) {

  for (i in 1:length(col)) {
    val_list <- col[[i]]
    if (is.na(val_list) | val_list == "None" | !str_detect(val_list, ",")) {
      col[[i]] <- val_list
    } else {
      vals <- unlist(str_split(val_list, ","))
      freq_vect <- c()
      for (val in vals) {
        freq <- category_counts %>%
          filter(categories == val) %>%
          select(n) %>%
          pull()
        freq_vect <- c(freq_vect, freq)
      }
      index <- pick_index_max(freq_vect)
      col[[i]] <- vals[index]
    }
  }
  return(col)
}

#### TOTAL FOOD COLUMN
system.time(food$categories <- my_reduce_2(food$categories))

large_categories_list <- food %>% 
  count(categories) %>% 
  arrange(desc(n)) %>% 
  head(50) %>% 
  pull(categories)


food_reduce <- food %>% 
  filter(categories %in% large_categories_list)

food_reduce <- food_reduce %>% 
  inner_join(food_attr_mod_2, by = "business_id")


cols = c("Alcohol", "NoiseLevel", "RestaurantsAttire", "WiFi", "aggBusinessParking", "aggAmbience", "aggGoodForMeal", "categories")
food_reduce[cols] <- lapply(food_reduce[cols], factor)
glimpse(food_reduce)

train_full <- food_reduce %>% 
  head(9*nrow(food_reduce)/10)

test_full <- food_reduce %>% 
  tail(1*nrow(food_reduce)/10)

fit_full <- randomForest(stars ~  RestaurantsPriceRange2 + categories + BusinessAcceptsCreditCards + Alcohol +  HasTV + NoiseLevel +  RestaurantsGoodForGroups + Caters + WiFi + aggBusinessParking + aggAmbience + aggGoodForMeal + review_count + BikeParking + GoodForKids + RestaurantsReservations + RestaurantsTakeOut + RestaurantsAttire + RestaurantsGoodForGroups, 
                    data=train_full, 
                    importance=TRUE,  
                    ntree=50)
varImpPlot(fit_full)

(r2 <- rSquared(test_full$stars, test_full$stars - predict(fit_full, test_full)))
plot(fit_full)

fit_full

predict_tbl <- predict(fit_full, test_full) %>% 
  data.frame()

colnames(predict_tbl) <- c("predicted_score")
for (i in 1:nrow(predict_tbl)){
  predict_tbl[i,"index"] <-  i 
}

predict_tbl %>% 
  filter(predicted_score > 4.2) %>% 
  pull() %>% 
  test_full[.,]

```

```{r random_forest_func}

random_forest <- function(x){
food_reduce <- food %>% 
  filter(categories == x)

food_reduce <- food_reduce %>% 
  inner_join(food_attr_mod_2, by = "business_id")


cols = c("Alcohol", "NoiseLevel", "RestaurantsAttire", "WiFi", "aggBusinessParking", "aggAmbience", "aggGoodForMeal", "categories")
food_reduce[cols] <- lapply(food_reduce[cols], factor)

train_full <- food_reduce %>% 
  head(9*nrow(food_reduce)/10)

test_full <- food_reduce %>% 
  tail(1*nrow(food_reduce)/10)

fit_full <- randomForest(stars ~  RestaurantsPriceRange2 + categories + BusinessAcceptsCreditCards + Alcohol +  HasTV + NoiseLevel +  RestaurantsGoodForGroups + Caters + WiFi + aggBusinessParking + aggAmbience + aggGoodForMeal + review_count + BikeParking + GoodForKids + RestaurantsReservations + RestaurantsTakeOut + RestaurantsAttire + RestaurantsGoodForGroups, 
                    data=train_full, 
                    importance=TRUE,  
                    ntree=50)

rSquared(test_full$stars, test_full$stars - predict(fit_full, test_full))

}

#Apply the function random forest to each element of the vector large_categories_list

r_squared <- purrr::map(large_categories_list[1:50],random_forest)


r_categories <-cbind(r_squared,large_categories_list[1:50])
r_categories_dt <- as.data.frame(r_categories, stringsAsFactors = FALSE)
```



```{r}
#rpart.control(minbucket=2)

analysis <- food_tall_reduce %>% 
  inner_join(food_attr_mod_2, by = "business_id") 



#########

train <- analysis %>% 
  head(9*nrow(analysis)/10)

test <- analysis %>% 
  tail(1*nrow(analysis)/10)
```


```{r linear regression}
#Used to merge stars to food attribute
food_stars <- food %>% 
  select(stars,business_id)

#food attr should be an aggregate dataset of all variables 
#categorical variables should have different level in one column
lm_data <- inner_join(food_stars,food_attr_mod_2,by= "business_id")

analysis1 <- lm_data %>% 
  select(stars,BusinessAcceptsCreditCards,RestaurantsPriceRange2,GoodForKids,BikeParking,Alcohol,HasTV,NoiseLevel,RestaurantsAttire,RestaurantsGoodForGroups,Caters,WiFi,RestaurantsReservations,RestaurantsTakeOut, aggBusinessParking, aggAmbience, aggGoodForMeal) 

 
#run linear analysis 
lm_a1 <- lm(stars ~ BusinessAcceptsCreditCards+RestaurantsPriceRange2+GoodForKids+BikeParking+Alcohol+HasTV+NoiseLevel+RestaurantsAttire+RestaurantsGoodForGroups+Caters+WiFi+RestaurantsReservations+RestaurantsTakeOut+aggBusinessParking+aggAmbience+aggGoodForMeal,data = analysis1)

AIC(lm_a1)
summary(lm_a1)$r.squared
summary(lm_a1)$adj.r.squared
lm_a1
```



```{r}

### PLAN ###
# Create power set of all column names
# Create function that takes a list of column names
# Filter the attributes data set by list
# Calculate highest OPT score
# Increase number of attributes until OPT score goes down

convert <- function(col_name, tbl) {
  index <- grep(col_name, colnames(tbl))
  col <- tbl[index]
  col[!is.na(col)] <- paste0(col_name, ",")
  col[is.na(col)] <- ""
  return(col)
}

cols_eval <- function(col_names, tbl) {
  food_attr_local <- tbl
  index_vect = c()
  for (col_name in col_names) {
    j <- grep(col_name, colnames(tbl))
    index_vect <- c(index_vect, j)
  }
  food_attr_local <- food_attr_local[index_vect] %>% 
    as.data.frame()
  
  food_attr_local <- map(col_names, function(x) convert(x,tbl)) %>% 
  as.data.frame()
  
  i <<- i + 1
  
  result <- food_attr_local %>% 
    unite(attr,sep = "", remove = TRUE) %>% 
    count(attr) %>% 
    mutate(num_attr = str_count(attr, ","),
           opt_score = num_attr*n, 
           group = i) %>% 
    top_n(3, num_attr * n) %>% 
    arrange(desc(num_attr * n))
  return(result)
}


powerset <- function(vect) {
  total <- list()
  # m/2 -> m
  for (m in ((1*length(vect))%/%20):length(vect)) {
    x <- combn(vect,m)
    y <- split(x, rep(1:ncol(x), each = nrow(x)))
    total <- list.append(total,y)
  }
  return(total)
} 



# TEST CASE
# cols_eval(c("GoodForKids", "RestaurantsGoodForGroups", "HasTV", "RestaurantsPriceRange2", "BusinessAcceptsCreditCards"), food_attr_mod)
# pwrset <- powerset(c("GoodForKids", "RestaurantsGoodForGroups", "HasTV", "RestaurantsPriceRange2", "BusinessAcceptsCreditCards")) 
# 
# result <- list()
# for (test_cols_wrap in pwrset){
#   for (test_cols in test_cols_wrap) {
#     temp <- c()
#     for (test_col in test_cols) {
#       temp <- c(temp, test_col)
#     }
#     result <- list.append(result,cols_eval(temp, food_attr_mod))
#   }
# }
# 
# resultdf <- as.data.frame(do.call("rbind", result))


find_best_cols <- function(tbl) {
  
  pwrset <- powerset(colnames(tbl))
  #print(pwrset)
  # for (test_col in pwrset){
  #   find_best_cols(test_col)
  # }
  i <<- 0
  final_lst <- list()
  for (test_cols_wrap in pwrset){
    for (test_cols in test_cols_wrap) {
      temp <- c()
      for (test_col in test_cols) {
        temp <- c(temp, test_col)
      }
    final_lst <- list.append(final_lst,cols_eval(temp, tbl))
    }
  
  }

  final_df <- as.data.frame(do.call("rbind", final_lst)) %>% 
    distinct() %>%
    mutate(group = as.factor(group))
  
  #final <- map_df(pwrset, function(x) cols_eval(x, tbl))
  
  g <- final_df %>%
    ggplot(aes(num_attr, n, color = opt_score)) +
    geom_point(size = 4) +
    #scale_color_distiller(palette = "RdBu", type = "div", direction = 1)
    scale_color_distiller(palette = "OrRd", direction = 1) + 
    theme_minimal()

  print(g)
  
  return(final_df %>% 
    arrange(desc(num_attr), desc(n)))
}
food_attr
# This might take a while
find_best_cols(food_attr_mod[24:28])

food_attr_mod

#### aggBusinessParking,aggAmbience,aggGoodForMeal,


food_attr 

food_attr_mod_2 <- food_attr %>% 
  select(-business_id) %>%
  cbind(food_attr_reduce) %>% 
#  select(-starts_with("Ambience"),-starts_with("GoodForMeal"),-starts_with("Music"),-starts_with("BusinessParking"), -starts_with("BestNights"),-ByAppointmentOnly, -CoatCheck, -RestaurantsCounterService, -Corkage, -ByAppointmentOnly, -AgesAllowed, -BusinessAcceptsBitcoin, -BYOB, -Open24Hours%>% 
  select(BusinessAcceptsCreditCards,RestaurantsPriceRange2,GoodForKids,BikeParking,Alcohol,HasTV,NoiseLevel,RestaurantsAttire,RestaurantsGoodForGroups,Caters,WiFi,RestaurantsReservations,RestaurantsTakeOut, aggBusinessParking, aggAmbience, aggGoodForMeal) %>% 

  drop_na()

```



```{r rpart regression tree}


  fit <- rpart(stars ~ BusinessAcceptsCreditCards+RestaurantsPriceRange2+GoodForKids+BikeParking+Alcohol+HasTV+NoiseLevel+RestaurantsAttire+RestaurantsGoodForGroups+Caters+WiFi+RestaurantsReservations+RestaurantsTakeOut+aggBusinessParking+aggAmbience+aggGoodForMeal, method = "anova", data = analysis1)

printcp(fit) # display the results 
plotcp(fit) # visualize cross-validation results 
summary(fit) # detailed summary of splits

par(mfrow=c(1,2)) # two plots on one page 
rsq.rpart(fit) # visualize cross-validation results  

prune(fit, cp = 0.02)

plot(fit, uniform=TRUE, 
  	main="Regression Tree for Mileage ")
text(fit, use.n=TRUE, all=TRUE)

```






### EDA -- Katie
```{r}
library(mapdata)
library(maps)
library(klaR)
```
```{r}
which(food$address == "Green Valley Ranch Resort, 2309 Paseo Verde Pkwy")
food %>% 
  filter(longitude > 110)
```

```{r}
df <- na.omit(analysis)
df <- df %>% 
  mutate(RestaurantsPriceRange2 = case_when(
    RestaurantsPriceRange2 == 2 ~ "2",
    RestaurantsPriceRange2 == 1 ~ "1",
    RestaurantsPriceRange2 == 3 ~ "3",
    RestaurantsPriceRange2 == 4 ~ "4"
  ))
temp <- df[c(13,15)]
test <- kmodes(temp, 3, iter.max = 10, weighted = FALSE)
test
```
s